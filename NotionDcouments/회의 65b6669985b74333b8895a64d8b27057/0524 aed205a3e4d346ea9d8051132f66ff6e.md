# 0524

상위 회의: 5월 (5%E1%84%8B%E1%85%AF%E1%86%AF%20165e6d39028a4ac49db3079ac9ca14c8.md)

![Untitled](0524%20aed205a3e4d346ea9d8051132f66ff6e/Untitled.png)

**utils/test_head_align.py**

- def test_head_align(*output1*):

1. 매핑

모든 영역(1~5영역)의 정렬된 상황에서 distance가 0(약 -20 ~ 20) 되도록 매핑

- 1, 2 영역은 head_x - tou_x = 음수
    
    ⇒  **calibration 양수**
    
- 3, 4, 5 영역은 head_x - tou_x = 양수
    
    ⇒  **calibartion 음수**
    
- distance = head_x - tou_x + **calibartion**

1. 기울기 판별
- distance가 -20 ~ 20 이면 정렬
- distance가 -20 보다 작을 때 왼/오 기울기 판별
- distance가 +20 보다 클 때 왼/오 기울기 판별

```python
def test_head_align(output1):     
    # 우선 순위에 따라 시리얼 프로세스 수정해야하는데 그건 이 함수 다 만들고 수정하자
    # TTS 및 비프음 체크

    # 생각 해야할 케이스: x 좌표값 460 부근에서 토우쪽 led 위치가 뒤집히는 상황 
    #                   (1, 2번 영역에서는 head_x - tou_x가 음수 값이고 3, 4 5번 영역에서는 head_x - tou_x가 양수 값)
    # 생각 해야할 케이스: IR 카메라 외곽에서, 정렬된 상황 자체에서 중앙보다 더 벌어져 있다.
    #                   영역 나누어서 처리하는 것이 필요

    #print("output1[1]: " , output1[1], "output1[3]: ", output1[3])

    head_x = 0
    head_y = 0
    tou_x = 0
    tou_y = 0

    # 헤드와 토우의 x, y값 구별: y가 더 큰 값이 토우 쪽 LED
    if output1[1] > output1[3]:
        tou_x = output1[0]
        tou_y = output1[1]
        head_x = output1[2]
        head_y = output1[3]
    else:
        head_x = output1[0]
        head_y = output1[1]
        tou_x = output1[2]
        tou_y = output1[3]
    
    #print("head: ", head_x, "tou: ", tou_x) 
    
    # default_distance 값을 영역에 따라 적절하게 구성하여, 정렬된 상황에서 head_x - tou_x가 거의 0이 되도록 맞추기
    # 그 후 threshold 값은 영역에 모두 동일하게 적용하여  
    #            head_x - tou_x의 결과를 양수 / 음수값으로 구분하여 정렬되지 않은 상황의 왼쪽/오른쪽 기울기 판별

    calibration = 0

    # x 좌표로 범위 구분 및 매핑
    if head_x < 340:
        print("1")
        #calibration = 60
    elif head_x > 340 and head_x < 470:
        print("2 left of center")
        #calibration = 40
    elif head_x > 470 and head_x < 560:
        print("3 right of center")
        #calibration = -20
    elif head_x > 560 and head_x < 590:
        print("4")
        #calibration = -40
    else: 
        print("5")
        #calibration= -60

    distance = head_x - tou_x + calibration

    # 정렬 및 기울어짐 판별
    if distance > -20 and distance < 20:
        print("align")
        #return const.default
    elif distance < -20:
        print("왼쪽으로 기울어짐")
        # return const.head_align
    elif distance > 20:
        print("오른쪽으로 기울어짐")
        # return const.head_align

```

---

- [ ]  ir 보정 및 정렬 완료
- [x]  pixel to cm 보정
    - [x]  output1이 높이있는 Led가 아니도록
    - [ ]  공과 헤드 사이의 거리 정확도 높이기
        - 현재 0.~mm

---

[센터 값] 

output1 481 322 383 320 

[전방 스티커]

output1 625 316 527 319 

[전방 스티커 2]

output1 601 320 712 407 

[후방 스티커 1]

output1 316 324 471 408

[후방 스티커 2]

output1 335 213 411 406 334 317 235 323