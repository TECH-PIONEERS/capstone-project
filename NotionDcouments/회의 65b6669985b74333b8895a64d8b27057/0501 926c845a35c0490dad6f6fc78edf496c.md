# 0501

상위 회의: 5월 (5%E1%84%8B%E1%85%AF%E1%86%AF%20165e6d39028a4ac49db3079ac9ca14c8.md)

라즈베리파이 5 카메라 - opencv 사용([picamera2](https://github.com/raspberrypi/picamera2))

[https://wiki.seeedstudio.com/reTerminal_DM_opencv/](https://wiki.seeedstudio.com/reTerminal_DM_opencv/)

- [x]  파이카메라 opencv로 열기
    - date 설정이 안되어있어서 고생을 함
        - `ntpdate -u [time2.kriss.re.kr](http://time2.kriss.re.kr)` 한국표준과학연구원 시간으로 동기화함
        
        ![Untitled](0501%20926c845a35c0490dad6f6fc78edf496c/Untitled.png)
        
    
    ```jsx
    no moduled name picamera2
    ```
    
- [x]  카메라 보정
    - [https://m.blog.naver.com/tobsysco/90188394402](https://m.blog.naver.com/tobsysco/90188394402)
    - 결과 데이터: 초점 거리, 주점, 왜곡 계수
        
        ```python
        
            fx = 297.454574
            fy = 297.454574
            cx = 300.000000
            cy = 200.000000
            k1 = -0.237153
            k2 = 0.025004
            p1 = -0.008951
            p2 = -0.010148
        ```
        
    - C++ 코드
        
        ```cpp
        double dCamMat[]={1223.742488, 0, 941.000000, 0, 1223.742488, 710.000000, 0, 0, 1}
        double dDstMat[]={-0.410419, 0.150130, 0.014093, -0.001272}
        CvMat matCameraMatrix= cvMat(3, 3, CV_64FC1, (void*)dCamMat)
        CvMat matDistortionMatrix= cvMat(1,4, CV_64FC1, (void*)dDstMat)
        ```
        
    - 파이썬 코드
        
        ```python
        def camera_calibaration(self,image):
        		# 카메라 매트릭스와 왜곡 계수 정의
        		mtx = np.array([[1223.742488, 0, 941.000000],[0, 1223.742488, 710.000000], [0, 0, 1]])
        		dist = np.array([[-0.410419, 0.150130, 0.014093, -0.001272]])		
        		
        		# 입력 이미지의 크기 가져오기
        		h, w = image.shape[:2]
        		
        		# 최적의 새 카메라 매트릭스 계산
        		newcameramtx, roi = cv2.getOptimalNewCameraMatrix(mtx,dist,(w,h),1,(w,h))
        		
        		# 이미지를 새 카메라 매트릭스에 맞게 왜곡 보정
            dst = cv2.undistort(image, mtx, dist, None, newcameramtx)
            
            # ROI(관심 영역) 추출
        		x,y,w,h = roi
        		dst = dst[y:y+h, x:x+w]
        		
        		return dst
        ```
        

- [ ]  ir sensor 위치 잡기(헤드위치) + 매핑
- [ ]  헤드 위치 기준으로 공 위치 찾기

- [ ]  헤드 홀 공 정렬
- [ ]  3d 모델링 - 카메라 지지용

---

참고 링크

[카메라 캘리브레이션 프로그램 (DarkCamCalibrator)](https://darkpgmr.tistory.com/139)

[[MFC]OpenCV를 이용한 카메라 왜곡 보정 방법.](https://m.blog.naver.com/tobsysco/90188394402)