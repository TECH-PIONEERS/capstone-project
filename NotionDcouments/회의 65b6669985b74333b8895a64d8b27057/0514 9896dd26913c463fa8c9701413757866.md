# 0514

상위 회의: 5월 (5%E1%84%8B%E1%85%AF%E1%86%AF%20165e6d39028a4ac49db3079ac9ca14c8.md)

[민성, 주미]

- [x]  IR 지연 해결

**mapping-0514 .py([링크](https://github.com/TECH-PIONEERS/capstone-project/blob/99216c2d9e6f08390733c603fd00c5b0141d81ce/opencv/mapping-0514%20.py))**

- 본 코드에 새로 추가된 사항
    - utils.py의 `def is_valid_string(input_string)` 에 전처리 & float → int 반복문 하나에 처리할 수 있도록 최적화
    - `def get_serial(conn)`
        
        ```python
        myPort = serial.Serial('/dev/ttyUSB1', 9600,timeout=0.1)
        myPort1 = serial.Serial('/dev/ttyUSB0', 9600, timeout=0.1)
        ```
        
        baud rate 9600, timeout = 0.1로 설정
        

IRCamera.ino([링크](https://github.com/TECH-PIONEERS/capstone-project/edit/main/IR/IRCamera.ino))

- 본 코드에서 수정된 사항
    - setup()의 Serial baudrate 설정 9600으로 하향
    
    ```arduino
    Serial.begin(9600);
    ```
    
    - loop함수의 delay 70ms로 증가
    
    ```arduino
    delay(70);
    ```
    
    - 시리얼 데이터에 아두이노 번호 추가(일단 적용 안 했음)
    0이 후면 센서
    1이 측면 센서
    
    아두이노 출력 데이터 예시
    
    ```python
    1,1023,1023,1023,1023,1023,1023,1023,1023
    1,1023,1023,1023,1023,1023,1023,1023,1023
    1,1023,1023,1023,1023,1023,1023,1023,1023
    1,1023,1023,1023,1023,1023,1023,1023,1023
    1,1023,1023,1023,1023,1023,1023,1023,1023
    ```
    
    ```arduino
    Serial.print("1");
    ```
    

**[ 해결할 부분 ]**

- [x]  좌표를 그리는 원이 깜박거리는 문제 → buffer에다 이전 값 저장해서 부드럽게 연결되도록 코드 수정
- [ ]  x 좌표 mapping

---

리모컨

- Help 버튼
- Replay 버튼

[지수]

---

[utils.py](http://utils.py) > return_ball_direction_change 함수 

공의 y좌표를 이용하여 방향이 전환되는지 파악

- [ ]  공 위치 추적이 깔끔하게 되는 상황에서 테스트가 필요함

```python
def return_ball_direction_change(previous_pos, current_pos, threshold=50):
    if abs(current_pos - previous_pos) >= threshold:
        if previous_pos < current_pos:
            print('bottom')
            return 'bottom'
        elif previous_pos > current_pos:
            print('up')
            return 'up'
```

**todo**

테스트에서 위 코드가 성공적일 경우

- [ ]  방향이 전환되었을 때 flag를 설정하여 방향이 전환되었을 경우 공이 홀을 지나가도 골이 아니라고 판단.

[예지]

---

## 리모컨 세팅

## Install LIRC

sudo apt update

sudo apt install -y lirc

## Check lirc version

lircd --version

## Setting up LIRC

(**/dev/lirc1**: receiver, **/dev/lirc0**: transmitter)

1. Edit **/etc/lirc/lirc_options.conf**
    
    driver = default
    
    device = /dev/lirc1
    
    (before:
    
    driver = devinput
    
    device = auto)
    
2. Edit **/boot/firmware/config.txt**
    
    dtoverlay=gpio-ir,gpio_pin=22
    
    dtoverlay=gpio-ir-tx,gpio_pin=23
    

## Reboot Raspberry Pi

sudo reboot

## Using IR Receiver (outputting raw data)

sudo systemctl stop lircd

mode2 -d /dev/lirc1

## 리모컨 및 버튼 등록

1. 등록명령
    
    `irrecord -d /dev/lirc1 TECH-PIONEERS`
    
2. 등록 버튼 (리모컨 맨 위의 버튼 3개)
- KEY_0 0xFFA25D
- KEY_1 0xFF629D
- KEY_2 0xFFE21D
1. 원본 백업 파일 생성
    
    `sudo mv /etc/lirc/lircd.conf /etc/lirc/lircd-backup.conf`
    
2. 내 백업 파일 생성
    
    `sudo cp TECH-PIONEERS.lircd.conf TECH-PIONEERS.lircd-backup.conf`
    
3. 새 구성 파일을 로드
    
    `sudo mv TECH-PIONEERS.lircd.conf /etc/lirc/lircd.conf`
    
    `sudo /etc/init.d/lircd -n reload`
    
4. 구성 파일 테스트
    
    `irsend LIST TECH-PIONEERS ""`
    
5. 리모컨 버튼 등록 테스트
    
    `irw`
    
6. 에러 해결
- 헤더가 코드에 포함된 경우
    - 문제 상황: 리모컨 설정 파일(TECH-PIONEERS.lircd.conf )를 열어보았을 때 각 키에 동일한 값 0x00000000이 포함되어 있었다. 이는 헤더에 해당하는 부분이 키의 실제 코드로 오인 되어서 irw에서 인식이 되지 않았던 것이었다.
    - 해결 방법: 0x00000000 부분을 지워서 문제를 해결하였다.
1. 동작 사진

![Untitled](0514%209896dd26913c463fa8c9701413757866/Untitled.png)