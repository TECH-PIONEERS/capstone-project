# 0530

상위 회의: 5월 (5%E1%84%8B%E1%85%AF%E1%86%AF%20165e6d39028a4ac49db3079ac9ca14c8.md)

test_final_code.py

- [x]  우선순위 문제 해결
- [x]  초반에 헤드 ir 값이 들어와도 안그려지는 문제 해결

## 매우매우매우 중요

기존 프로젝트 폴더를 삭제하고 새로 clone을 받아서 사용중입니다.

아래 path의 캡스톤 폴더 사용

path : ~/capstone-proejct/

### 참고!!!

우선순위 문제 해결하는 과정에서 get_serial 프로세스에 있던 헤드 정렬 코드를  opencv 프로세스 쪽으로 옮겼음 (위치 상관x 원래 자리로 옮겨도 됨)

```jsx

if len(new_output) == 4 and tts_flag.value >= const.head_align:
      print(f"tts_Flag1 {tts_flag.value}")
      tts_flag.value = utils.test_head_align(output1)
      print(f"tts_Flag2 {tts_flag.value}")
```

output에 대한 ir positioning camera 위치를 중앙으로 옮기는 테스트를 진행하면서 코드 calibration 값을 0.42 에서 0.29로 변경했음 따라서 현재 opencv frame에 그려지는 ir 위치가 매우 다를 것임 

```python
if(len(output) > 3):
    calibration_y = 0.29
    diff_y = abs(output[0]-output[2])
    diff_limit = 110
    if diff_y < diff_limit:
        offset = abs(diff_limit-diff_y)//9
    else:
        offset = 0
    output_cali_y1 = int((output[0])//4 * calibration_y - offset)
    output_cali_y2 = int((output[2])//4 * calibration_y + offset)
```

- [ ]  ir positoning camera 위치를 어디로 할 것인지 다함께 의논이 필요함

ir positioning camera 위치를 원래대로 돌려서 사용할거라면 calibration_y 값을 변경

```python
if(len(output) > 3):
    calibration_y = 0.42
    diff_y = abs(output[0]-output[2])
    diff_limit = 110
    if diff_y < diff_limit:
        offset = abs(diff_limit-diff_y)//9
    else:
        offset = 0
    output_cali_y1 = int((output[0])//4 * calibration_y - offset)
    output_cali_y2 = int((output[2])//4 * calibration_y + offset)
```

변경해도 위치가 맞지 않는다면 아래로 진행. 그래도 맞지 않는다면 카톡(태그 or 전화) 주세요

```python
if(len(output) > 3):
    calibration_y = 0.42
    diff_y = abs(output[0]-output[2])
    diff_limit = 100
    if diff_y < diff_limit:
        offset = abs(diff_limit-diff_y)//5
    else:
        offset = 0
    output_cali_y1 = int((output[0])//4 * calibration_y - offset)
    output_cali_y2 = int((output[2])//4 * calibration_y + offset)
```

## **todo**

- [ ]  공 헤드 위치 범위 벗어났을 때 처리
- [ ]  beep path 찾지못하는 문제 발생
- [ ]  beep 소스 회의록에 정리 (케이스별로 어떤 비프음 사용할것인지 + 소스 부족하면 추가)
- [ ]  헤드 정렬 y축 -> 의논 (기존 방식 or 위치 변경)
- [ ]  공 쳤을 때 판단
- [ ]  공이 골에 안들어갔을 경우 공의 방향
    - 공 방향 함수는 기존에 만들어놓긴했으나 개선 필요할 것으로 보임 (예외케이스 처리)
- [ ]  골 여부 판단 연결
- [ ]  공이 골에 안들어갔을 경우 공의 이동 거리
    - 기존에 공과 헤드 사이의 거리 파악하는 함수를 리팩토링해서 사용할 예정 (is_Moving 변수 활용)
        - 이 역시 공을 쳤을 때 판단이 매우 중요함

---

- [ ]  처음에 ir 값이 들어오는데 빠르면2초 느리면 5초이상이 걸림 최적화 가능할까?
- [ ]  파일 정리 (집에 가기 전에 ㄱ)